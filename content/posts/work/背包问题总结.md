---
title: "背包问题总结"
date: 2020-02-03T12:45:21+08:00
description: "简单总结了背包问题的几个情况"
tags: ["算法", "动态规划"]
draft: true
---

背包问题是面试算法中经常涉及的经典题目，这类问题讨论的是如何在资源有限的情况下达到最优选择。解决此类问题的主流算法是`动态规划`，动态规划的难点在于如何抽象出`状态转移方程`并实现为代码。背包问题的变型很多，不过万变不离其宗，本文就尝试带你理清问题脉络，抽象出一套解决同类问题的方法，希望对你有所帮助。

## 01背包问题

01背包问题是所有背包问题的基础，典型表述为*已知背包容量为`n`, 每种物品只有1件，只能选择放或不放，求能带走最多的重量(或者价值)*。



### 01背包问题-案例1

完整的题目表述为：*在背包容量已知为V的前提下，有N件物品(重量为Wi)，求可以放入物品的最大质量和*。

要判断第i个物品要不要放入容量为V的背包，是两种选择的比较：

- 放入第i个物品，此时背包能放入的最大质量 = 容量为`V-*Wi*`的背包能放下的最大质量 + 第i个物品的质量
- 不放入第i个物品，容量为V的背包能放下的最大质量

![img](http://minio.gogodjzhu.com/images/20210403_103428_7c7d3444-c432-44c9-8f7f-6749beb3a28f.png)

写成公式，即状态转移方程：

```
F[i,v]=max{F[i−1,v],F[i−1,v−Wi] + Wi} (i>=1)
```

- `F[i,v]`指`前i件`物品放入容量为`v`的背包能装下的最大容量; 
- `F[i-1,v]`是`前i-1件`物品放入容量为`v`的背包能装下的最大容量(即选择不放`第i件`物品)
- `F[i-1,v-Wi]+Wi`是`前i-1`件物品放入容量为`v-Ci`(留出Ci的空间放第i件物品)的背包能装下的最大容量 + `第i件`物品的重量`Wi`(即选择放第i件物品)

这个方程非常重要，基本上所有跟背包问题相关的方程都是由他衍生出来的。要实现这个方程，关键在于`F[i,v]`的状态保存——显然可以实现为一个二维数组。

由于状态转移方程的约束条件是`{i>=1}`，还需要定义方程的初始条件i=0。即不选用任何物品，此时不论v为任何值能放下的最大质量显然都为0，即初始值为：F[0,v]=0，下面是求解的伪代码：

```
F[0, 0...V] <- 0
for i <- 1 to N
    for v <- 1 to V (或者优化为 for v <- Wi to V)
        F[i,v]=max{F[i−1,v],F[i−1,v−Wi] + Wi}
```

空间复杂度：`o(V*W)`
时间复杂度：`o(V*W)`

> leetcode上面有[416. 分割等和子集](https://leetcode-cn.com/problems/partition-equal-subset-sum/), 可以将其理解成背包容量为`half(Sum(arr))`能放下的最大容量是多少的另一种提问方式。你可以利用它来验证你的代码。



#### 01背包问题-空间复杂度优化

使用一个二维数组来保存每次遍历的完整过程，是对状态转移方程的直接翻译。但事实上我们每次遍历需要的只是`F[i-1,0...V]`，因此可以将二维数组优化为一维, 仅保存`F[i,v]`在每次循环中的最新值。以下各种背包问题的延伸均可通过此方法进行空间优化, 不再赘述。

空间复杂度：`o(V)`
时间复杂度：`o(V*W)`



### 01背包问题-案例2

这是一种常见的变型，表述为：`N`件物品，质量为`Wi`, 价值`Pi`，求如何放入物品可令背包价值最高。

相应地，状态转移方程变为：

```
F[i,v]=max{F[i−1,v],F[i−1,v−*Wi*]+Pi} {i>=1}
```

方程中，F的涵义从容量变成价值, 放入`第i件`物品产生的增量变成`Pi`即其价值。

> 特别地, 可以将案例1的问题理解成案例2的一个特例，即物品的价值P与其重量W相等



### 01背包问题-案例3

满包问题：*`N`件物品，质量为`Wi`, 价值`Pi`，求恰好放满背包时能装下的最大价值*。要解决此类问题需稍微修改初始值为：

```
F[0,0]=0, F[0,1…V]=-∞
```

表示不选择任何物品的时候，除了容量为0的背包(最大质量为0)，其他任何背包都无法填满。在遍历过程中，遇到-∞则判断为无法实现。即若`F[i-1,v-*Wi*]=-∞`，则`F[i-1,v-*Wi*]+Pi`无法成立，那么`F[i,v]=max{F[i−1,v],F[i−1,v−*Wi*]+Pi}`应该取`F[i−1,v]`。

状态转移方程：

```
F[i,v]=max{F[i-1,v], F[i,v-Wi]+Pi | F[i,v-Wi]!=-∞} (i>=1)
```

> -∞也可以替换为任意不会与合法价值混淆的特殊值，如负数



## 完全背包问题

完全背包问题跟01背包问题的区别在于，物品可以选择的次数是无限的，每件物品不是只有不放入(0)和放入(1)两种情况，还可以任意选择放入的数量。



### 完全背包问题-案例1

典型的完全背包是这样表述的: *已知背包容量为V的前提下, 有N种物品(价值为P), 数量无限, 求背包能放下的最大价值*。

状态转移方程为:

```
F[i,v]=max{F[i−1,v],F[**i**,v−*Wi*]+Pi} {i>=1}
```

对比**01背包问题**的状态转移方程发现变化为，从`F[i−1,v−*Wi*]+Pi`变成`F[i,v-*Wi*]+Pi`。

变化的这一项代表的物理意义是，当选择第i件物品的时候背包能装下的最大价值。在01背包中，当背包腾出Wi空间来放第i件物品时，是不能选择第`i`件物品的（因为只有一件），所以只能取`F[i-1,v-*Wi*]`。但完全背包问题没有此限制，只要满足有足够`Wi`空间放下第`i`件物品即可，在`v-*Wi*`的空间里也可能有第`i`个物品，故取`F[i,v-*Wi*]`。



### 完全背包问题-案例02

此种题目从计算价值，变为计算填满背包的方案数量。

完整表述为：*已知背包容量V, 有一批物品重Wi, 价值Pi, 每件物品数量无限, 求放满背包有多少种方案*

状态转移方程变为:

```
F[i,v]=F[i-1,v]+F[i,v-*Wi*]
```

定义状态`F[i,v]`表示：在`前i件`物品可选时，填满容量为v的背包有几种方案。

方程对应的物理意义为: 不使用`第i个`物品装满v背包的方案数 + 使用`第i个`物品的前提下装满v背包的方案数。

[leetcode.518.零钱兑换 II](https://leetcode-cn.com/problems/coin-change-2/)



## 多重背包问题

所谓多重，多出来的一重维度就是每种物品的可用数量。

完整问题表述为：*已知背包容量`V`，N种物品，每件物品的重量`Wi`，价格`Pi`，可选数量为`Mi`。求背包能放下的最大价值*。

在理解了`完全背包问题`的思路后就容易讨论了。